<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ecto-Trigger: Usage Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ecto-Trigger<span id="projectnumber">&#160;0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_guides_2usage.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Usage Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md15"></a></p>
<h1><a class="anchor" id="autotoc_md16"></a>
Overview</h1>
<p>Ecto-Trigger comprises a basic <a href="https://ross-jg.github.io/ecto-trigger/html/annotated.html">collection of files</a>. Where each file defines a class and command-line interface for independent tasks.</p>
<p>This guide explains how to use each of the scripts in the Ecto-Trigger toolkit - from training a model to running inference.</p>
<p>All the tools are modular, so you can use them together, or independently depending on your needs. Each script is also well documented with comments to make it easy to extend.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Suggested Workflow</h1>
<ol type="1">
<li>Prepare your dataset in class-based folders</li>
<li>Train a model (<code><a class="el" href="model__trainer_8py.html">model_trainer.py</a></code>)</li>
<li>Evaluate it (<code><a class="el" href="model__evaluator_8py.html">model_evaluator.py</a></code>)</li>
<li>Quantise for deployment (<code><a class="el" href="model__quantiser_8py.html">model_quantiser.py</a></code>)</li>
<li>Deploy to field hardware (<a class="el" href="md_guides_2deployment.html">Deployment Guide</a>)</li>
<li>Optionally visualize attention maps (<code><a class="el" href="saliency__map__evaluator_8py.html">saliency_map_evaluator.py</a></code>)</li>
</ol>
<h1><a class="anchor" id="autotoc_md18"></a>
<a href="../model_loader.py">model_loader.py</a></h1>
<p>This file contains a class, <code>ModelLoader</code>, with static methods <code>create_model()</code>, <code>load_keras_model()</code> and <code>load_tflite_model()</code>.</p>
<p>These are intended to be accessed from other files, as loading a model on its own is not much use. Below is shown how to load a model using <code>python</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> model_loader <span class="keyword">import</span> ModelLoader</div>
<div class="line"> </div>
<div class="line"><span class="comment"># this line will load a Keras model from a .hdf5 checkpoint file</span></div>
<div class="line">k_model = ModelLoader.load_keras_model(<span class="stringliteral">&quot;path/to/weights.hdf5&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># this line will load a compressed tflite model from a .tflite file</span></div>
<div class="line">q_model = ModelLoader.load_tflite_model(<span class="stringliteral">&quot;path/to/weights.tflite&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># to create your own model, use the function below</span></div>
<div class="line">k_model = ModelLoader.create_model((1080, 1080, 3), 0.5, dropout_rate=0.2, freeze_base=<span class="keyword">False</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line">&gt; Input:  .hdf5 file (Keras model)</div>
<div class="line">&gt; Output: TensorFlow model object</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
<a href="../model_trainer.py">model_trainer.py</a></h1>
<p>This file contains a class, <code>ModelTrainer</code>, which can be instantiated in Python as shown:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> model_trainer <span class="keyword">import</span> ModelTrainer</div>
<div class="line"> </div>
<div class="line">mt = ModelTrainer({<span class="stringliteral">&quot;train_data_dir&quot;</span>: <span class="stringliteral">&quot;/path/to/train/data&quot;</span>, <span class="stringliteral">&quot;val_data_dir&quot;</span>: <span class="stringliteral">&quot;/path/to/val/data&quot;</span>, <span class="stringliteral">&quot;batch_size&quot;</span> : 16, <span class="stringliteral">&quot;input_shape&quot;</span> : (120,160,3), <span class="stringliteral">&quot;alpha&quot;</span>: 0.35, <span class="stringliteral">&quot;log_dir&quot;</span> : <span class="stringliteral">&quot;logs&quot;</span>, <span class="stringliteral">&quot;model_type&quot;</span>: <span class="stringliteral">&quot;Mobnetv2&quot;</span>, <span class="stringliteral">&quot;epochs&quot;</span> : 2, <span class="stringliteral">&quot;use_pretrained_weights&quot;</span> : <span class="keyword">False</span>}) </div>
<div class="line">mt.train()</div>
</div><!-- fragment --><p>You can also call <code><a class="el" href="model__trainer_8py.html">model_trainer.py</a></code> from the command line: </p><div class="fragment"><div class="line">python model_trainer.py \</div>
<div class="line">    --train_data_dir &quot;/path/to/train/data&quot; \</div>
<div class="line">    --val_data_dir &quot;/path/to/validation/data&quot; \</div>
<div class="line">    --batch_size 16 \</div>
<div class="line">    --input_shape &quot;(120, 160, 3)&quot; \</div>
<div class="line">    --alpha 0.35 \</div>
<div class="line">    --log_dir &quot;logs&quot; \</div>
<div class="line">    --epochs 20 \</div>
</div><!-- fragment --><div class="fragment"><div class="line">&gt; Input: Folder(s) of labelled images in YOLO format for training and validation</div>
<div class="line">&gt; Output: Trained `.hdf5` model, logs for TensorBoard</div>
</div><!-- fragment --><p> These commands will start a model training, you can check its progress using <code>Tensorboard</code> by passing it the log directory: </p><div class="fragment"><div class="line">tensorboard --logdir=logs</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md20"></a>
<a href="../model_evaluator.py">model_evaluator.py</a></h1>
<p>This file contains a class, <code>ModelEvaluator</code>, which can be instantiated in Python as shown to load the weights for model 8: </p><div class="fragment"><div class="line"><span class="keyword">from</span> model_evaluator <span class="keyword">import</span> ModelEvaluator</div>
<div class="line">me = ModelEvaluator(16, (120, 160, 3), <span class="stringliteral">&quot;model_weights/8/checkpoints/weights.10.hdf5&quot;</span>, <span class="stringliteral">&quot;/path/to/validation/data&quot;</span>) </div>
<div class="line">me.evaluate()</div>
</div><!-- fragment --><p> You can also call <code><a class="el" href="model__evaluator_8py.html">model_evaluator.py</a></code> from the command line: </p><div class="fragment"><div class="line">python model_evaluator.py \</div>
<div class="line">    --batch_size 16 \</div>
<div class="line">    --weights_path &quot;model_weights/8/checkpoints/weights.10.hdf5&quot; \</div>
<div class="line">    --test_data_dir &quot;/path/to/validation/data&quot;</div>
</div><!-- fragment --><div class="fragment"><div class="line">&gt; Input: Trained `.hdf5` model, test image folder </div>
<div class="line">&gt; Output: Accuracy score, loss printed to terminal window</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
<a href="../model_quantiser.py">model_quantiser.py</a></h1>
<p>This file contains a class, <code>ModelQuantiser</code> which can be instantiated in Python as shown to quantise a given model in keras <code>.hdf5</code> format and save it as a <code>.tflite</code> file. </p><div class="fragment"><div class="line"><span class="keyword">from</span> model_quantiser <span class="keyword">import</span> ModelQuantiser</div>
<div class="line">mq = ModelQuantiser(</div>
<div class="line">        weights_file=<span class="stringliteral">&quot;/path/to/weights.hdf5&quot;</span>,</div>
<div class="line">        representative_dataset=<span class="stringliteral">&quot;/path/to/representative_dataset,</span></div>
<div class="line"><span class="stringliteral">        representative_example_nr=100</span></div>
<div class="line"><span class="stringliteral">    )</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment"># Quantise the model</span></div>
<div class="line">    quantiser.quantise_model(output_path=<span class="stringliteral">&quot;/path/to/weights.tflite&quot;</span>)</div>
</div><!-- fragment --><p> You can also call <code><a class="el" href="model__quantiser_8py.html">model_quantiser.py</a></code> from the command line: </p><div class="fragment"><div class="line">python model_quantiser.py \</div>
<div class="line">  --weights_file /path/to/weights.hdf5 \</div>
<div class="line">  --representative_dataset /path/to/representative_dataset \</div>
<div class="line">  --representative_example_nr 100 \</div>
<div class="line">  --output /path/to/weights.tflite</div>
</div><!-- fragment --><div class="fragment"><div class="line">&gt; Input: Trained `.hdf5` model, image folder for representative dataset</div>
<div class="line">&gt; Output: `.tflite` model file (optimised using quantisation)</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md22"></a>
<a href="../saliency_map_evaluator.py">saliency_map_evaluator.py</a></h1>
<p>This file contains a class <code>SaliencyMapGenerator</code>, which can plot saliency maps alongside output confidence and the input image. It can be accessed in python as follows: </p><div class="fragment"><div class="line"><span class="keyword">from</span> saliency_map_evaluator <span class="keyword">import</span> SaliencyMapGenerator</div>
<div class="line">smg = SaliencyMapGenerator(weights_file=<span class="stringliteral">&quot;model_weights/8/checkpoints/weights.10.hdf5&quot;</span>)</div>
<div class="line">smg.generate_saliency_map(input_image_path=<span class="stringliteral">&quot;input.png&quot;</span>, output_path=<span class="stringliteral">&quot;saliency_plot.png&quot;</span>)</div>
</div><!-- fragment --><p> You can also call <code><a class="el" href="saliency__map__evaluator_8py.html">saliency_map_evaluator.py</a></code> from the command line: </p><div class="fragment"><div class="line">python saliency_map_evaluator.py \</div>
<div class="line">  --weights_file model_weights/8/checkpoints/weights.10.hdf5 \</div>
<div class="line">  --input_image input.png \</div>
<div class="line">  --output saliency_plot.png</div>
</div><!-- fragment --> <div class="fragment"><div class="line">&gt; Input: A trained model and input image</div>
<div class="line">&gt; Output: An image showing the rescaled input, saliency map and an overlay with prediction confidence</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
<a href="../generator.py">generator.py</a></h1>
<p>This file contains a class <code>CustomDataGenerator</code>, which provides an iterable generator for Keras models, handling the preprocessing, augmentation, and batching of data for YOLO-format object detection annotations to binary classification ones.</p>
<p>You can use <code>CustomDataGenerator</code> in Python as follows: </p><div class="fragment"><div class="line"><span class="keyword">from</span> generator <span class="keyword">import</span> CustomDataGenerator</div>
<div class="line">data_gen = CustomDataGenerator(</div>
<div class="line">    data_directory=<span class="stringliteral">&quot;/path/to/dataset&quot;</span>,</div>
<div class="line">    batch_size=16,</div>
<div class="line">    input_shape=(224, 224, 3),</div>
<div class="line">    stop_training_flag={<span class="stringliteral">&quot;stop&quot;</span>: <span class="keyword">False</span>},</div>
<div class="line">    shuffle=<span class="keyword">True</span></div>
<div class="line">)</div>
<div class="line">X, y = data_gen[0]</div>
</div><!-- fragment --><div class="fragment"><div class="line">&gt; Input: Folder of images</div>
<div class="line">&gt; Output: Numpy arrays of image batches</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
